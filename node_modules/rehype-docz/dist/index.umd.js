"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var babylon=require("babylon"),traverse=_interopDefault(require("babel-traverse")),prettier=require("prettier"),logger=_interopDefault(require("signale")),is=_interopDefault(require("unist-util-is")),nodeToString=_interopDefault(require("hast-util-to-string")),strip=_interopDefault(require("strip-indent"));const codeFromNode=e=>r=>{let t="";const o=babylon.parse(r,{plugins:["jsx"]});return traverse(o,{enter(o){if(e(o))return t=r.slice(o.node.start,o.node.end),void o.stop()}}),t},format=e=>new Promise((r,t)=>{try{r(prettier.format(e,{parser:"babylon",semi:!1,singleQuote:!0,trailingComma:"all"}))}catch(e){logger.fatal(e),r(e)}}),componentName=e=>{const r=e.match(/^\<\\?(\w+)/);return r&&r[1]},isPlayground=e=>"Playground"===e,isOpenTag=e=>e.isJSXOpeningElement()&&isPlayground(e.node.name.name),isClosetag=e=>e.isJSXClosingElement()&&isPlayground(e.node.name.name),removePlayground=e=>{const r=codeFromNode(isOpenTag),t=codeFromNode(isClosetag);return e.replace(r(e),"").replace(t(e),"")},addCodeProp=async(e,r)=>{const t=componentName(e.value),o=RegExp(`^\\<${t}`);if(isPlayground(t)){const n=(await format(nodeToString(e))).slice(1,1/0),i=strip(removePlayground(n)).trim();e.value=e.value.replace(o,`<${t} __position={${r}} __code={\`${i}\`}`)}};var index=()=>e=>{const r=[e.children.filter(e=>is("jsx",e)).map(addCodeProp)];return Promise.all(r).then(()=>e)};exports.default=index;
